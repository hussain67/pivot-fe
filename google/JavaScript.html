<script>
  // if this is changed, change default selected option in html too
  const DEFAULT_OPTIONS = 4;
  window.addEventListener('load', onLoad);

  function onLoad() {
    // prevent default form submission
    document.getElementById("pivot-form").addEventListener('submit', function (e) {
      e.preventDefault();
      })
      // get current ids from slides server and update hidden form fields
    google.script.run.withSuccessHandler(updateFormIds).getPresentationAndSlideIds();
    // set correct answer options to default
    setCorrectAnswerOptions(DEFAULT_OPTIONS);
  }

  function updateFormIds(result) {
    // result is an object containing presentationId and slideId
    console.log("RESULT", result);
    document.getElementById('presentationid-field').value = result.presentationId;
    document.getElementById('slideid-field').value = result.pageId;
  }

  function setCorrectAnswerOptions(num) {
    const selectEl = document.getElementById('correct-answer');
    selectEl.innerHTML = "";
    const options = ["A", "B", "C", "D", "E", "F"].slice(0,num);
    options.forEach(function (option) {
      var newOption = document.createElement("option");
      newOption.innerHTML = option;
      newOption.value = option;
      selectEl.appendChild(newOption);
    })
  }

  function handleNumAnswersUpdate(selectEl) {
    var num = selectEl.options[selectEl.selectedIndex].value;
    setCorrectAnswerOptions(num);
  }

  function handleFormSubmit(formObject) {
    google.script.run.withSuccessHandler(updateUrl).processForm(formObject);
  }

  function updateUrl(successBool) {
    var div = document.getElementById('output');
    div.innerHTML = '<a href="' + url + '">Got it!</a>';
  }

  function launchPresentation() {
    const presentationId = document.getElementById('presentationid-field').value;
    window.open("https://rhs-pivot-backend.herokuapp.com/"+presentationId);
    google.script.run.withSuccessHandler(displayScreenShot).generateScreenshots(presentationId);
  }

  function displayScreenShot(screenshots) {
    document.getElementById('slide-image').src = screenshots[0]
    console.log("UPDATING IMAGE TO", screenshots[0]);
  }
</script>